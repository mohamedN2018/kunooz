<!-- templates/articles.html -->
{% extends 'base.html' %}

{% block title %}المقالات - كنوز{% endblock %}

{% block extra_css %}
<style>
    /* تنسيقات المقالات */
    :root {
        --article-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
        --category-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }

    /* تصميم الهيدر */
    .articles-header {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.9) 100%);
    }

    .dark .articles-header {
        background: linear-gradient(135deg, rgba(6, 95, 70, 0.9) 0%, rgba(4, 120, 87, 0.9) 100%);
    }

    /* تصميم البطاقات */
    .article-card {
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        height: 100%;
    }

    .dark .article-card {
        border-color: #4a5568;
    }

    .article-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .dark .article-card:hover {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
    }

    /* صورة المقال */
    .article-image {
        position: relative;
        height: 240px;
        overflow: hidden;
    }

    .article-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s ease;
    }

    .article-card:hover .article-image img {
        transform: scale(1.1);
    }

    /* شارة التصنيف */
    .category-badge {
        position: absolute;
        top: 16px;
        right: 16px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        color: #10b981;
        z-index: 10;
    }

    .dark .category-badge {
        background: rgba(30, 41, 59, 0.9);
        color: #34d399;
    }

    /* شارة وقت القراءة */
    .reading-time-badge {
        position: absolute;
        top: 16px;
        left: 16px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        display: flex;
        align-items: center;
        gap: 4px;
        z-index: 10;
    }

    /* محتوى البطاقة */
    .article-content {
        padding: 24px;
    }

    /* معلومات المؤلف */
    .author-info {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }

    .author-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }

    /* إحصائيات المقال */
    .article-stats {
        display: flex;
        gap: 20px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e2e8f0;
    }

    .dark .article-stats {
        border-top-color: #4a5568;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #6b7280;
        font-size: 14px;
    }

    .dark .stat-item {
        color: #9ca3af;
    }

    /* المقالات المميزة */
    .featured-article {
        position: relative;
        overflow: hidden;
        border-radius: 20px;
    }

    .featured-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 600;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    /* التصنيفات */
    .category-card {
        position: relative;
        overflow: hidden;
        padding: 20px;
        border-radius: 16px;
        transition: all 0.3s ease;
        text-align: center;
    }

    .category-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    /* فلترة المقالات */
    .filter-container {
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }

    .dark .filter-container {
        background: #1e293b;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }

    /* ترقيم الصفحات */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 40px;
    }

    .page-link {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .page-link.active {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
    }

    /* الرسوم المتحركة */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-article {
        animation: fadeInUp 0.6s ease forwards;
    }

    /* تصميم للمقالات الفارغة */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-state-icon {
        font-size: 64px;
        color: #d1d5db;
        margin-bottom: 20px;
    }

    .dark .empty-state-icon {
        color: #4b5563;
    }

    /* استجابة للشاشات الصغيرة */
    @media (max-width: 768px) {
        .article-image {
            height: 200px;
        }
        
        .article-content {
            padding: 16px;
        }
        
        .filter-container {
            padding: 16px;
        }
        
        .category-card {
            padding: 16px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- الهيدر الرئيسي -->
<section class="articles-header text-white py-20">
    <div class="absolute inset-0 bg-black/10"></div>
    <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 animate-fade-in">
                المقالات التعليمية
            </h1>
            <p class="text-xl opacity-90 mb-8">
                اكتشف مقالات تعليمية متخصصة في مختلف المجالات، مكتوبة بواسطة خبراء ومتخصصين
            </p>
            
            {% if user.is_authenticated and user.profile.is_content_editor %}
            <a href="{% url 'create_post' %}" 
               class="inline-flex items-center gap-2 bg-white text-green-600 px-8 py-3 rounded-full hover:bg-gray-100 font-bold transition-all duration-300 transform hover:scale-105 shadow-lg">
                <i class="fas fa-plus-circle"></i>
                <span>إضافة مقال جديد</span>
            </a>
            {% endif %}
        </div>
    </div>
</section>

<!-- الفلترة والبحث -->
<section class="py-8">
    <div class="container mx-auto px-4">
        <div class="filter-container">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- شريط البحث -->
                <div class="flex-1">
                    <form method="get" action="{% url 'search' %}" class="relative">
                        <div class="relative">
                            <input type="text" 
                                   name="q" 
                                   placeholder="ابحث في المقالات..." 
                                   class="w-full px-6 py-3 pr-12 border-2 border-gray-200 dark:border-gray-700 rounded-full focus:outline-none focus:border-green-500 dark:focus:border-green-400 text-lg transition-all duration-300"
                                   value="{{ request.GET.q|default:'' }}">
                            <button type="submit" 
                                    class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-green-500 transition-colors">
                                <i class="fas fa-search text-xl"></i>
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- الفلاتر -->
                <div class="flex flex-wrap gap-3">
                    <form method="get" class="flex flex-wrap gap-3">
                        <!-- فلترة التصنيف -->
                        <div class="relative">
                            <select name="category" onchange="this.form.submit()" 
                                    class="appearance-none bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-full px-6 py-3 pr-10 focus:outline-none focus:border-green-500 dark:focus:border-green-400 cursor-pointer transition-all duration-300 min-w-[200px]">
                                <option value="">جميع التصنيفات</option>
                                {% for cat in available_categories %}
                                <option value="{{ cat.name }}" {% if current_category_filter == cat.name %}selected{% endif %}>
                                    {{ cat.name }} ({{ cat.post_count }})
                                </option>
                                {% endfor %}
                            </select>
                            <div class="absolute left-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                <i class="fas fa-filter text-gray-400"></i>
                            </div>
                        </div>
                        
                        <!-- فلترة الترتيب -->
                        <div class="relative">
                            <select name="sort" onchange="this.form.submit()"
                                    class="appearance-none bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-full px-6 py-3 pr-10 focus:outline-none focus:border-green-500 dark:focus:border-green-400 cursor-pointer transition-all duration-300 min-w-[180px]">
                                <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>الأحدث</option>
                                <option value="popular" {% if current_sort == 'popular' %}selected{% endif %}>الأكثر مشاهدة</option>
                                <option value="commented" {% if current_sort == 'commented' %}selected{% endif %}>الأكثر تعليقاً</option>
                            </select>
                            <div class="absolute left-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                <i class="fas fa-sort text-gray-400"></i>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- الإحصائيات السريعة -->
<section class="py-12 bg-gray-50 dark:bg-gray-900">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg text-center transform hover:scale-105 transition-all duration-300">
                <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">{{ total_posts }}</div>
                <div class="text-gray-600 dark:text-gray-300">مقال منشور</div>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg text-center transform hover:scale-105 transition-all duration-300">
                <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">{{ total_authors }}</div>
                <div class="text-gray-600 dark:text-gray-300">كاتب متخصص</div>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg text-center transform hover:scale-105 transition-all duration-300">
                <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">{{ total_views|floatformat:0 }}</div>
                <div class="text-gray-600 dark:text-gray-300">قراءة للمقالات</div>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg text-center transform hover:scale-105 transition-all duration-300">
                <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">{{ total_comments }}</div>
                <div class="text-gray-600 dark:text-gray-300">تعليق وإعجاب</div>
            </div>
        </div>
    </div>
</section>

<!-- المقالات -->
<section class="py-16">
    <div class="container mx-auto px-4">
        {% if posts %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for post in posts %}
            <div class="animate-article" style="animation-delay: {{ forloop.counter0|divisibleby:3|yesno:'0,0.1,0.2' }}s">
                <article class="article-card bg-white dark:bg-gray-800">
                    <!-- صورة المقال -->
                    <div class="article-image">
                        {% if post.get_main_image %}
                        <img src="{{ post.get_main_image.url }}" 
                             alt="{{ post.title }}"
                             class="w-full h-full object-cover">
                        {% else %}
                        <div class="w-full h-full bg-gradient-to-r from-green-400 to-green-600 flex items-center justify-center">
                            <i class="fas fa-newspaper text-white text-5xl"></i>
                        </div>
                        {% endif %}
                        
                        <!-- شارة التصنيف -->
                        <div class="category-badge">
                            <i class="fas fa-folder ml-1"></i>
                            {{ post.category.name }}
                        </div>
                        
                        <!-- وقت القراءة -->
                        <div class="reading-time-badge">
                            <i class="fas fa-clock"></i>
                            <span>{{ post.link_delay }} ثانية</span>
                        </div>
                    </div>
                    
                    <!-- محتوى المقال -->
                    <div class="article-content">
                        <!-- العنوان -->
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-3 leading-tight">
                            <a href="{% url 'post_detail' post.slug %}" 
                               class="hover:text-green-600 dark:hover:text-green-400 transition-colors duration-300">
                                {{ post.title|truncatechars:70 }}
                            </a>
                        </h3>
                        
                        <!-- الوصف -->
                        <p class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-3 leading-relaxed">
                            {{ post.excerpt|default:post.content|striptags|truncatechars:120 }}
                        </p>
                        
                        <!-- معلومات الكاتب -->
                        <div class="author-info">
                            {% if post.author.profile.profile_image %}
                            <img src="{{ post.author.profile.profile_image.url }}" 
                                 alt="{{ post.author.get_full_name }}" 
                                 class="author-avatar">
                            {% else %}
                            <div class="author-avatar bg-gradient-to-r from-green-400 to-green-600 flex items-center justify-center text-white font-bold">
                                {{ post.author.first_name|default:post.author.username|first|upper }}
                            </div>
                            {% endif %}
                            <div>
                                <div class="font-medium text-gray-800 dark:text-white">
                                    {{ post.author.get_full_name|default:post.author.username|truncatechars:15 }}
                                </div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-calendar ml-1"></i>
                                    {{ post.publish_date|date:"Y/m/d" }}
                                </div>
                            </div>
                        </div>
                        
                        <!-- الإحصائيات -->
                        <div class="article-stats">
                            <div class="stat-item">
                                <i class="fas fa-eye"></i>
                                <span>{{ post.views|default:0 }}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-comment"></i>
                                <span>{{ post.comments.count }}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-clock"></i>
                                <span>{{ post.link_delay }} ث</span>
                            </div>
                        </div>
                        
                        <!-- زر القراءة -->
                        <a href="{% url 'post_detail' post.slug %}" 
                           class="block mt-4 text-center bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg hover:opacity-90 font-medium transition-all duration-300 transform hover:scale-105">
                            اقرأ المقال
                            <i class="fas fa-arrow-left mr-2"></i>
                        </a>
                    </div>
                </article>
            </div>
            {% endfor %}
        </div>
        
        <!-- الترقيم -->
        {% if posts.has_other_pages %}
        <div class="mt-16">
            <nav class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-gray-600 dark:text-gray-300 text-sm">
                    عرض {{ posts.start_index }} إلى {{ posts.end_index }} من أصل {{ posts.paginator.count }} مقال
                </div>
                
                <div class="pagination">
                    {% if posts.has_previous %}
                    <a href="?page={{ posts.previous_page_number }}{% if current_category_filter %}&category={{ current_category_filter }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" 
                       class="page-link bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                    {% endif %}
                    
                    {% for num in posts.paginator.page_range %}
                        {% if posts.number == num %}
                        <span class="page-link active">{{ num }}</span>
                        {% elif num > posts.number|add:'-3' and num < posts.number|add:'3' %}
                        <a href="?page={{ num }}{% if current_category_filter %}&category={{ current_category_filter }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" 
                           class="page-link bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                            {{ num }}
                        </a>
                        {% endif %}
                    {% endfor %}
                    
                    {% if posts.has_next %}
                    <a href="?page={{ posts.next_page_number }}{% if current_category_filter %}&category={{ current_category_filter }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" 
                       class="page-link bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                    {% endif %}
                </div>
            </nav>
        </div>
        {% endif %}
        
        {% else %}
        <!-- حالة عدم وجود مقالات -->
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-700 dark:text-gray-300 mb-4">لا توجد مقالات حالياً</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-8 max-w-md mx-auto">
                لم يتم نشر أي مقالات في هذا القسم بعد. يمكنك تصفح الأقسام الأخرى أو العودة لاحقاً.
            </p>
            
            {% if user.is_authenticated and user.profile.is_content_editor %}
            <a href="{% url 'create_post' %}" 
               class="inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-full hover:opacity-90 font-bold transition-all duration-300 transform hover:scale-105 shadow-lg">
                <i class="fas fa-plus-circle"></i>
                ابدأ بكتابة أول مقال
            </a>
            {% else %}
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="{% url 'register' %}" 
                   class="inline-flex items-center justify-center gap-2 bg-green-600 text-white px-8 py-3 rounded-full hover:bg-green-700 font-bold transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-user-plus"></i>
                    انضم إلينا
                </a>
                <a href="{% url 'courses' %}" 
                   class="inline-flex items-center justify-center gap-2 bg-white dark:bg-gray-800 border-2 border-green-600 text-green-600 dark:text-green-400 px-8 py-3 rounded-full hover:bg-green-50 dark:hover:bg-gray-700 font-bold transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-video"></i>
                    تصفح الكورسات
                </a>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>

<!-- المقالات المميزة -->
{% if featured_posts %}
<section class="py-16 bg-gray-50 dark:bg-gray-900">
    <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-10">
            <div>
                <h2 class="text-3xl font-bold text-gray-800 dark:text-white flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-star"></i>
                    </div>
                    مقالات مميزة
                </h2>
                <p class="text-gray-600 dark:text-gray-300 mt-2">أفضل المقالات المختارة خصيصاً لك</p>
            </div>
            <span class="px-4 py-2 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-full text-sm font-medium">
                الأكثر مشاهدة هذا الشهر
            </span>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {% for post in featured_posts %}
            <div class="featured-article bg-white dark:bg-gray-800 shadow-2xl">
                <div class="relative h-64 md:h-80">
                    {% if post.get_main_image %}
                    <img src="{{ post.get_main_image.url }}" 
                         alt="{{ post.title }}" 
                         class="w-full h-full object-cover">
                    {% else %}
                    <div class="w-full h-full bg-gradient-to-r from-yellow-500 to-yellow-600 flex items-center justify-center">
                        <i class="fas fa-newspaper text-white text-6xl"></i>
                    </div>
                    {% endif %}
                    
                    <!-- شارة مميز -->
                    <div class="featured-badge">
                        <i class="fas fa-crown"></i>
                        مميز
                    </div>
                    
                    <!-- التصنيف -->
                    <div class="absolute bottom-4 right-4">
                        <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300 px-4 py-2 rounded-full text-sm font-bold">
                            {{ post.category.name }}
                        </span>
                    </div>
                </div>
                
                <div class="p-8">
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4 leading-tight">
                        <a href="{% url 'post_detail' post.slug %}" class="hover:text-yellow-600 dark:hover:text-yellow-400 transition-colors">
                            {{ post.title }}
                        </a>
                    </h3>
                    
                    <p class="text-gray-600 dark:text-gray-300 mb-6 line-clamp-3">
                        {{ post.excerpt|default:post.content|striptags|truncatechars:150 }}
                    </p>
                    
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div class="flex items-center gap-6">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                                <i class="fas fa-eye"></i>
                                <span class="font-medium">{{ post.views }} مشاهدة</span>
                            </div>
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                                <i class="fas fa-comment"></i>
                                <span class="font-medium">{{ post.comments.count }}</span>
                            </div>
                        </div>
                        
                        <a href="{% url 'post_detail' post.slug %}" 
                           class="inline-flex items-center gap-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-6 py-3 rounded-lg hover:opacity-90 font-medium transition-all duration-300 transform hover:scale-105">
                            اقرأ المقال
                            <i class="fas fa-arrow-left"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- التصنيفات الشائعة -->
{% if available_categories %}
<section class="py-16">
    <div class="container mx-auto px-4">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">تصفح حسب التصنيف</h2>
            <p class="text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                اختر من بين مجموعة متنوعة من التصنيفات للعثور على المقالات التي تهمك
            </p>
        </div>
        
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-6">
            {% for cat in available_categories|slice:":6" %}
            <a href="?category={{ cat.name }}" 
               class="category-card bg-white dark:bg-gray-800 hover:bg-green-50 dark:hover:bg-green-900/20 group">
                <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-green-100 to-green-200 dark:from-green-900 dark:to-green-800 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-folder text-green-600 dark:text-green-400 text-2xl"></i>
                </div>
                <div class="font-bold text-green-800 dark:text-green-300 text-lg mb-1">{{ cat.name }}</div>
                <div class="text-gray-500 dark:text-gray-400 text-sm">{{ cat.post_count }} مقال</div>
            </a>
            {% endfor %}
        </div>
        
        {% if available_categories.count > 6 %}
        <div class="text-center mt-12">
            <button onclick="toggleMoreCategories()" 
                    class="inline-flex items-center gap-2 text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 font-medium text-lg transition-colors duration-300">
                <span id="categoriesToggleText">عرض المزيد من التصنيفات</span>
                <i class="fas fa-chevron-down" id="categoriesToggleIcon"></i>
            </button>
        </div>
        
        <div id="moreCategories" class="hidden mt-8">
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-6">
                {% for cat in available_categories|slice:"6:" %}
                <a href="?category={{ cat.name }}" 
                   class="category-card bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <div class="font-bold text-gray-700 dark:text-gray-300 text-sm mb-1">{{ cat.name }}</div>
                    <div class="text-gray-500 dark:text-gray-400 text-xs">{{ cat.post_count }} مقال</div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}

<!-- JavaScript -->
<script>
// تفعيل التصفية عند تغيير القيمة
document.querySelectorAll('select[name="category"], select[name="sort"]').forEach(select => {
    select.addEventListener('change', function() {
        const form = this.closest('form');
        const params = new URLSearchParams();
        
        if (form.querySelector('select[name="category"]').value) {
            params.append('category', form.querySelector('select[name="category"]').value);
        }
        
        if (form.querySelector('select[name="sort"]').value) {
            params.append('sort', form.querySelector('select[name="sort"]').value);
        }
        
        // إضافة رقم الصفحة الحالي إذا كان موجوداً
        const currentPage = new URLSearchParams(window.location.search).get('page');
        if (currentPage) {
            params.append('page', currentPage);
        }
        
        window.location.href = window.location.pathname + '?' + params.toString();
    });
});

// عرض/إخفاء المزيد من التصنيفات
function toggleMoreCategories() {
    const moreCategories = document.getElementById('moreCategories');
    const toggleText = document.getElementById('categoriesToggleText');
    const toggleIcon = document.getElementById('categoriesToggleIcon');
    
    if (moreCategories.classList.contains('hidden')) {
        moreCategories.classList.remove('hidden');
        moreCategories.classList.add('grid');
        toggleText.textContent = 'عرض أقل من التصنيفات';
        toggleIcon.classList.remove('fa-chevron-down');
        toggleIcon.classList.add('fa-chevron-up');
        
        // إضافة تأثير ظهور
        moreCategories.style.opacity = '0';
        moreCategories.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            moreCategories.style.opacity = '1';
            moreCategories.style.transform = 'translateY(0)';
        }, 10);
    } else {
        moreCategories.classList.remove('grid');
        moreCategories.classList.add('hidden');
        toggleText.textContent = 'عرض المزيد من التصنيفات';
        toggleIcon.classList.remove('fa-chevron-up');
        toggleIcon.classList.add('fa-chevron-down');
    }
}

// إضافة تأثيرات عند التمرير
document.addEventListener('DOMContentLoaded', function() {
    // إضافة تأثيرات للبطاقات
    const cards = document.querySelectorAll('.article-card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
    });
    
    // إضافة تأثيرات للمقالات المميزة
    const featuredArticles = document.querySelectorAll('.featured-article');
    featuredArticles.forEach((article, index) => {
        article.style.animationDelay = `${index * 0.2}s`;
    });
    
    // تأثير التمرير السلس للروابط الداخلية
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;
            
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});

// إضافة تأثيرات hover للبطاقات
document.querySelectorAll('.article-card').forEach(card => {
    card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-8px)';
    });
    
    card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0)';
    });
});

// تحسين تجربة البحث
const searchInput = document.querySelector('input[name="q"]');
if (searchInput) {
    searchInput.addEventListener('focus', function() {
        this.parentElement.classList.add('ring-2', 'ring-green-500');
    });
    
    searchInput.addEventListener('blur', function() {
        this.parentElement.classList.remove('ring-2', 'ring-green-500');
    });
}
</script>
{% endblock %}